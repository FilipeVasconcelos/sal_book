\documentclass[a4paper,12pt]{scrbook}

\usepackage[utf8]{inputenc} 
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[french]{babel}
\addto\captionsfrench{\renewcommand{\bibname}{Références}}
\addto\captionsfrench{\def\tablename{Tableau}}
\addto\captionsfrench{\renewcommand\appendixname{Annexe}\renewcommand\appendixpagename{Annexes}
}
\usepackage[skip=0.3cm,hypcap=false]{caption} 
\captionsetup{width=.8\linewidth} 
\usepackage[french]{minitoc}
%\usepackage[multiple]{footmisc}
%\usepackage{pdfpages}
\usepackage{mathrsfs}
\usepackage{graphicx}
%\usepackage{subfig}
\usepackage{subcaption}
\usepackage{lscape}
\usepackage{enumitem}
\usepackage{pifont}
\usepackage{rotating}
\usepackage{epstopdf}
\usepackage{mathtools}
\usepackage[squaren,Gray,cdot]{SIunits}
\usepackage{afterpage}
\usepackage[dvipsnames]{xcolor}
%\usepackage{slashbox}
\usepackage{eso-pic,calc}                
\usepackage{imakeidx}
\makeindex[columnsep=20pt,columnseprule]
\usepackage[colorlinks]{hyperref}
\usepackage{url} % url dans bibtex
\usepackage[hyphenbreaks]{breakurl} 
\usepackage[ucmark,toc,hyperfirst=false]{glossaries}
\makeglossaries
\loadglsentries{tex/glossary}
\usepackage[french,nameinlink,noabbrev]{cleveref}
\DeclareRobustCommand{\abbrevcrefs}{%
    \crefname{figure}{Fig.}{Figs.}%
    \crefname{equation}{\'Eq.}{\'Eqs.}%
    \crefname{table}{Tab.}{Tabx.}%
}
\DeclareRobustCommand{\cshref}[1]{{\abbrevcrefs\cref{#1}}}
\crefname{appchap}{Annexe}{Annexes}
\usepackage{tocbibind}
%\usepackage{blindtext}
\usepackage{float}
\usepackage{titletoc}%
\usepackage[page]{appendix}
\usepackage{
    % babel,
    % hyperref,
    % hyperxmp,
}
%\usepackage[type={CC},
%            modifier={by-sa},
%            imagemodifier={-eu},
%            imageposition=right,
%            version={4.0},
%           ]{doclicense}

\makeatletter

\titlecontents{chapter}%
 [0em]% 
 {\bfseries}%
 {\bfseries\@chapapp\ \thecontentslabel\quad}% 
 {\hspace{-0em}}% 
 {\hfill\contentspage}% 

\g@addto@macro\appendices{%
\addtocontents{toc}{\protect\renewcommand{\protect\@chapapp}{\appendixname}}%
}

\DeclareUnicodeCharacter{2212}{$-$}

\makeatother

%\usepackage{pdfcrop}
\usepackage{pdflscape}
\usepackage{lipsum}
%\usepackage{adjustbox}
\usepackage{etoolbox}
\usepackage{pgf,tikz}
\usepackage{tkz-euclide}
\usepackage{tikz-3dplot}
\usepackage{pst-3dplot}
\usepackage{xargs}
\usetikzlibrary{calc,tikzmark}
\usetikzlibrary{quotes,angles}
\usetikzlibrary{arrows.meta,bending,automata,positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{babel} 
\usetikzlibrary{decorations.text}
\usetikzlibrary{matrix}
\usepackage{pgfplots}
\pgfplotsset{compat=1.14}
\usetkzobj{all} 
\usetikzlibrary{external}
%\usepgfplotslibrary{external}
\usepackage{amsmath,amsthm,amssymb}
\tikzset{external/system call={latex \tikzexternalcheckshellescape 
-halt-on-error  -interaction=batchmode -jobname "\image" "\texsource"; 
dvips -o "\image".ps "\image".dvi;
ps2eps -f "\image.ps"
}}
\tikzset{external/optimize command away=\AddToShipoutPicture}
%\tikzexternalize[mode=graphics if exists,
%figure list=true,prefix=fig/]
\tikzexternalize[prefix=fig/]

\usepackage{rpcinematik} % liaisons cinématiques normalisées Robert Papnicola

\usepackage{booktabs}
\usepackage{array}
\usepackage{makecell}
\usepackage{hhline}
\renewcommand\cellalign{cc}
%\renewcommand{\arraystretch}{4.0}
\usepackage{tabulary}
\usepackage{footnote}
\renewcommand{\footnoterule}{%
    \kern -3pt  % call this kerna
    \hrule height 0.4pt width 0.6\columnwidth
    \kern 2.6pt % call this kernb
}

\newcolumntype{K}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}
\newcolumntype{N}{@{}m{0pt}@{}}

\def\fup#1{\raise+2pt\hbox{\footnotesize #1}}

\usepackage[a4paper,headheight=16pt]{geometry}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LO]{\bfseries\rightmark}
\fancyhead[RO]{\makebox[0pt][l]{\makebox[2cm][r]{\bfseries \thepage}}}
\fancyhead[LE]{\makebox[0pt][r]{\makebox[2cm][l]{\bfseries \thepage}}}
\fancyhead[RE]{\bfseries\leftmark}
\fancypagestyle{plain}{%
\fancyhead{} % get rid of headers
\renewcommand{\headrulewidth}{0pt} % and the line
}

\let\origprintindex\printindex
\renewcommand*{\printindex}{%
  \pagestyle{plain}
  \origprintindex
}
\setcounter{minitocdepth}{2}
\setcounter{secnumdepth}{3}

\frenchbsetup{AutoSpaceFootnotes=false,FrenchFootnotes=false}

\newcommand{\textop}[1]{\relax\ifmmode\mathop{\text{#1}}\else\text{#1}\fi}
\renewcommand{\bar}{\overline}

% à compléter...
\newcommand*{\acpl}{\emph{à compléter}\ldots}
\newcommand*{\todo}[1]{\emph{TODO : #1}}
\newcommand*{\SLCI}{\emph{{\scshape Slci}}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% fmv *.sty
\usepackage{mymath}
\usepackage{schemabloc}
\usepackage{gfluence}
\usepackage{vecteurs}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%tikz
\newcommand{\AxisRotator}[1][rotate=0]{%
	    \tikz [x=0.25cm,y=0.60cm,line width=.2ex,-stealth,#1] \draw (0,0) arc (-150:150:1 and 1);%
}

\newcommand{\tdcylxy}[5]{% origin x, origin y, origin z, radius, height
    \path (1,0,0);
    \pgfgetlastxy{\cylxx}{\cylxy}
    \path (0,1,0);
    \pgfgetlastxy{\cylyx}{\cylyy}
    \path (0,0,1);
   \pgfgetlastxy{\cylzx}{\cylzy}
   \pgfmathsetmacro{\cylt}{(\cylzy * \cylyx - \cylzx * \cylyy)/ (\cylzy * \cylxx - \cylzx * \cylxy)}
  \pgfmathsetmacro{\ang}{atan(\cylt)}
   \pgfmathsetmacro{\ct}{1/sqrt(1 + (\cylt)^2)}
    \pgfmathsetmacro{\st}{\cylt * \ct}
    \filldraw[fill=blue!50!white,opacity=0.50] (#4*\ct+#1,#4*\st+#2,#3) -- ++(0,0,#5) arc[start angle=\ang,delta angle=180,radius=#4] -- ++(0,0,-#5) arc[start angle=\ang+180,delta angle=180,radius=#4];
    \filldraw[fill=blue!50!white,opacity=0.50] (#1,#2,#3) circle[radius=#4];
}

\makeatletter
\addtocounter{secnumdepth}{1}
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand{\thesubsubsection}{\thesubsection.\arabic{subsubsection}}
\@addtoreset{equation}{chapter}
\renewcommand\paragraph{\@startsection{paragraph}{5}{\parindent}%
{3.25ex \@plus1ex \@minus .2ex}%
{0.75ex plus 0.1ex}% space after heading
{\normalfont\normalsize\bfseries}}
\makeatother
\renewcommand{\theequation}{\thechapter.\arabic{equation}}
\parindent0pt

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% footnote and hyperref
\let\oldFootnote\footnote
\newcommand\nextToken\relax

\renewcommand\footnote[1]{%
    \oldFootnote{#1}\futurelet\nextToken\isFootnote}

\newcommand\isFootnote{%
    \ifx\footnote\nextToken\textsuperscript{,}\fi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%COLOR BOX conseil
\usepackage[many,listings,skins,breakable]{tcolorbox}
\newtcolorbox{tips}[2][]{%
  enhanced,
  width=\textwidth,
  fonttitle=\bfseries,
  fonttitle=\bfseries\color{black},
  colframe=Melon,
  colback=Melon!10,
  title={#2},
	#1
}
\newtcolorbox{criteria}[2][]{%
  enhanced,
  width=\textwidth,
  fonttitle=\bfseries,
  fonttitle=\bfseries\color{white},
  colframe=Black,
  colback=Black!10,
  title={#2},
  #1
}
\newtcolorbox{theorem}[2][]{%
  enhanced,
  breakable,
  width=\linewidth ,
  fonttitle=\bfseries,
  fonttitle=\bfseries\color{black},
  %sharpish corners,
  colframe=gray!50,
  colback=gray!10,
  title={#2},
	#1
}
\newtcolorbox{bequation}[1][]{%
  enhanced,
  width=\textwidth,
  sharpish corners,
  colframe=white,
  colback=gray!20,
  after=,
  #1
}
\newtcolorbox{code}[1][]{%
%before=\begin{center},after=\end{center},
enhanced,
breakable,
width=\linewidth,
%sharpish corners,
%colframe=blue!60,
colback=blue!8,
#1
}
\newtcolorbox{doc}[1][]{%
%before=\begin{center},after=\end{center},
enhanced,
breakable,
width=\linewidth,
%sharpish corners,
colframe=red!60,
colback=red!8,
#1
}

\tikzset{cross/.style={cross out, draw=black, minimum size=2*(#1-\pgflinewidth), inner sep=0pt, outer sep=0pt},
        %default radius will be 1pt. 
cross/.default={1pt}}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\tcbuselibrary{skins}
\tcbset{shield externalize,
    pccstyle/.style={,
        enhanced,flushleft upper,
        boxrule=1.6pt,
        colback=white,colframe=black!50!yellow,
        drop fuzzy midday shadow=black!50!yellow
    }
}

\newcommand\BackgroundPic{%
    { \tikzset{external/export=false}
\put(0,0){%
\parbox[b][\paperheight]{\paperwidth}{%
\begin{picture}(0,0)
\put(50,-130){\includegraphics[width=4cm]{fig/LOGO_ESME_QUADRI.EPS}}
\end{picture}
\vfill
\centering
%\tikzsetnextfilename{cover_ext}
\input{tikz/cover}
\vfill
}}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\tikzset{%
  % use: dblarw={color}{totalouterwidth}{outlineinsidewidth}
  dblarw/.style n args={3}{%,
    -latex,
    line width=#2,
    draw=#1,  % this draw and color could
    color=#1, % be an additional style arg
    opacity=0.9,
    % note: just color=#1 makes all black! 
    % fill=#1 makes insides (in an open! curve) filled too!
    % draw=#1,color=#1, seems to work, though
    postaction={
      draw=#1,
      color=#1,
      line width=#2-#3,
      shorten >=2*#3,
      shorten <=#3,
    },
    dblarw/.default={gray}{5pt}{1pt},
    dblarw/.initial={gray}{5pt}{1pt},
  }
}

\tikzstyle{solid}=                   [dash pattern=]
\tikzstyle{dotted}=                  [dash pattern=on \pgflinewidth off 2pt]
\tikzstyle{densely dotted}=          [dash pattern=on \pgflinewidth off 1pt]
\tikzstyle{loosely dotted}=          [dash pattern=on \pgflinewidth off 4pt]
\tikzstyle{dashed}=                  [dash pattern=on 3pt off 3pt]
\tikzstyle{densely dashed}=          [dash pattern=on 3pt off 2pt]
\tikzstyle{loosely dashed}=          [dash pattern=on 3pt off 6pt]
\tikzstyle{dashdotted}=              [dash pattern=on 5pt off 2pt on \the\pgflinewidth off 2pt]
\tikzstyle{densely dashdotted}=      [dash pattern=on 3pt off 1pt on \the\pgflinewidth off 1pt]
\tikzstyle{loosely dashdotted}=      [dash pattern=on 3pt off 4pt on \the\pgflinewidth off 4pt]

\tikzset{BarreStyle/.style =   {opacity=.3,line width=4mm,line cap=round,color=#1}}
\tikzset{SignePlus/.style  =   {above left,opacity=0.8,circle,inner sep=0.5pt,fill=#1!50}}
\tikzset{SigneMoins/.style =   {above right,opacity=0.8,circle,inner sep=0.5pt,fill=#1!50}}
\tikzset{node style ge/.style={circle,font=\bf}}

%red
\newcommand{\hmr}[1]{%
  \ooalign{\hss\makebox[0pt]{\fcolorbox{white}{red!30}{$#1$}}\hss\cr\phantom{$#1$}}%
}
%blue
\newcommand{\hmb}[1]{%
  \ooalign{\hss\makebox[0pt]{\fcolorbox{white}{blue!30}{$#1$}}\hss\cr\phantom{$#1$}}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%page page
%\newcommand*\cleartoleftpage{\clearpage\ifodd\c@page
%\hbox{}\vspace*{\fill}\thispagestyle{empty}
%\newpage\fi}
\newcommand*\cleartoleftpage{%
\clearpage
\ifodd\value{page}\hbox{}\newpage\fi
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\graphicspath{{./fig/}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\includeonly{}
%\includeonly{avantpropos,chap0}
\includeonly{tex/chap0}
%\includeonly{chap1}
%\includeonly{chap2,annexe1}
%\includeonly{chap2,annexe1,annexe4}
%\includeonly{chap3}
%\includeonly{chap4}
%\includeonly{chap5}
%\includeonly{chap6}
%\includeonly{chap1,chap6}
%\includeonly{annexe1}
%\includeonly{annexe2}
%\includeonly{annexe3}
%\includeonly{annexe4}
%\includeonly{annexe5}
%\includeonly{annexe6}
%\includeonly{todo}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\setcounter{chapter}{-1}

\begin{document}

%\frontmatter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{tex/pagedegarde}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\pagecolor{white}
\mbox{}
\thispagestyle{empty}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\thispagestyle{empty}
\input{tex/pagedegarde2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\thispagestyle{empty}
\input{tex/pagedegarde3}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\dominitoc
\tableofcontents
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\include{tex/avantpropos} 
\include{tex/chap0} 
\include{tex/chap1} 
\include{tex/chap2} 
\include{tex/chap3} 
\include{tex/chap4} 
{\tikzset{external/export=false}
\include{tex/chap5} 
\include{tex/chap6} 
}
\include{tex/chap7} 
\include{tex/chap8} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{appendices}
\crefalias{chapter}{appchap}
\include{tex/annexe1}
\include{tex/annexe2}
\include{tex/annexe3}
\include{tex/annexe4}
{\tikzset{external/export=false}
\include{tex/annexe5}
\include{tex/annexe6}
}
\end{appendices}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\backmatter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\nocite{*}
\bibliographystyle{plain}
\bibliography{sma_auto.bib}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\printindex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\printglossary[title={Glossaire}]
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cleartoleftpage
$\,$
\thispagestyle{empty}
\pagecolor{yellow!15}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}
